# 基于 FPGA 与 NPU 协同的硬件级防御架构设计（未实现版）

## 项目概述

本项目提出一种以 FPGA 作为 “交互网关”、NPU 专注 “模型计算” 的硬件级防御架构构想，旨在通过硬件层面的 “功能拆分 + 动态重构” 应对底层漏洞，填补硬件级未知漏洞利用的防御空白。该设计仅针对硬件防御，病毒木马等软件威胁仍需依赖杀毒软件。作为项目发起人 **"Yumura"**，我期望依托社区力量共同将此构想落地并完善。

## 核心架构与执行流程（设计构想）

### 架构组成



*   **FPGA（交互网关）**：计划包含 DMA 控制器、指令 / 行为过滤、通信接口三个核心模块，负责非信任区交互，如接收 OS 基础指令、转发 NPU 检测结果、处理 DMA 请求等。

*   **NPU（计算核心）**：作为安全核心，计划运行专用大模型，负责敏感的指令检测、内存分析，防御未知漏洞、非法指令及非法操作。

*   **辅助组件**：计划包含定制 Linux 内核模块、外接电源及独立的 FPGA 更新触发按钮。

### 执行流程



| 步骤 | 操作主体 | 设计中的具体行为                                                                                 |
| -- | ---- | ---------------------------------------------------------------------------------------- |
| 1  | FPGA | 计划通过 PCIe 读取内存片段，对数据进行向量化以便大模型使用，同时捕捉 CPU 写入内存的指令序列片段，提取 opcode 序列及操作数特征，过滤正常指令，保留异常模式候选 |
| 2  | NPU  | 计划由运行在独立 NPU 上的大模型对向量化的内存数据及指令特征进行深度检查，实现对未知漏洞、非法指令或非法操作的防御                              |
| 3  | FPGA | 计划接收 NPU 的异常判定结果后，通过定制内核模块向 OS 发送中断信号，触发指令执行暂停                                           |

## FPGA 的核心优势设计（构想）：锁定漏洞风险



1.  **动态重构对抗硬件漏洞**：构想中，FPGA 的逻辑可通过固件更新实时重配置，无需像传统 ASIC 那样物理更换即可修复漏洞，而传统硬件（比如固定逻辑的 ASIC）一旦曝出漏洞，几乎只能靠物理更换。

2.  **隔离 “计算核心” 与 “交互面”**：设计中 NPU 作为模型运行的 “安全核心”，负责敏感的指令检测、内存分析；FPGA 只做 “非信任区交互”。即使 FPGA 被攻破（概率远低于 NPU 被直接攻击），NPU 的模型和核心逻辑仍计划处于物理隔离的区域（比如通过内部总线隔离），不会被直接篡改。这种 “分层防御” 设计比单一硬件更抗风险。

3.  **适配 “硬件触发更新” 机制**：设计中 FPGA 板载一个独立的 “更新触发按钮”，按下后 FPGA 先进入 “安全模式”（切断与 OS 的交互），通过加密通道（如 SPI 从外部存储读取新固件）完成重构，整个过程不依赖 OS，避免更新时被恶意程序干扰。同时计划实现固件更新的 “双区校验”：FPGA 内部划分 “运行区” 和 “备份区”，更新时先把新固件写入备份区，校验哈希和签名无误后再切换运行区，防止更新过程中掉电或被篡改导致 FPGA 变砖。且计划最小化 FPGA 逻辑：FPGA 的交互逻辑越简单，漏洞面越小，比如只保留 “地址解析、数据转发、校验” 三个核心模块。

## 大模型的防御逻辑与边界（设计构想）

### 计划的防御范围

设计中大模型将基于训练数据（含已知非法指令样本、漏洞利用特征、正常指令分布），识别以下异常：



*   指令组合违反 CPU 架构规范（如未定义 opcode）；

*   指令序列与正常程序行为模式偏离（如短时间高频调用特权指令）；

*   内存访问指令的目标地址与程序段权限不匹配（如用户态指令访问内核态内存）；

*   类似 “熔断”“幽灵” 的典型内存访问模式、shellcode 的特征指令序列（如堆喷射、栈溢出触发的异常跳转）。

### 预期的局限性



*   无法解析指令完整上下文语义，对完全新型的指令混淆技术，识别率依赖模型泛化能力；

*   对零日漏洞仅能通过分析正常基线外的行为偏差提升预警可能性，无法保证 100% 识别；

*   判断基于概率，对与正常操作高度相似的攻击可能漏判，需结合多层日志审计；

*   不覆盖软件层面漏洞（如应用层缓冲区溢出），需配合系统补丁与杀毒软件。

## 社区协作指南（待启动）

### 贡献方向



*   固件开发：参与 FPGA 固件的开发与优化，提升动态重构效率、完善双区校验机制。

*   模型训练：参与 NPU 上运行的大模型训练，扩充漏洞样本库、优化指令特征提取规则。

*   兼容性适配：参与适配更多硬件平台、完善与不同 OS 的交互逻辑。

*   文档完善：参与补充技术细节、编写使用教程与调试指南。

### 参与方式（待明确）



*   待项目初始化后，可提交 Issue 反馈问题，通过 Pull Request 贡献代码或文档。

*   待项目 Discussions 板块开通后，可用于技术交流，重要问题可通过邮件联系维护者。

## 许可条款（拟定）

本项目计划采用**GPLv3 + 非商业使用补充条款**授权：



*   允许自由复制、修改和分发本项目的设计文档及代码。

*   任何修改版本必须以相同许可发布，且保留原作者信息。

*   禁止将本项目及衍生作品用于商业用途，包括但不限于嵌入商业硬件产品、提供付费安全服务等。

*   非商业用途包括学术研究、个人学习、开源社区协作等。

## 参考项目

清华大学团队提出的 “CPU 硬件安全动态监测管控技术” 具有参考价值，该技术将 CPU 从逻辑上分为运算引擎和监测控制电路，通过对比 CPU 运行时硬件的实际行为与指令集给出的预期行为差异，实时判断是否存在硬件安全威胁。

## 免责声明

本设计目前仅为一种架构构想，其预期价值在于填补硬件级未知漏洞利用的防御空白，即使未来实现，也无法替代现有安全方案，使用者仍需结合多种安全措施构建完整防护体系。



***

本项目目前处于构想阶段，其落地与发展高度依赖社区协作，期待更多开发者、研究者参与进来，共同将构想转化为现实，优化防御逻辑、拓展应用场景，让硬件级防御技术更趋完善。

> （注：文档部分内容可能由 AI 生成）